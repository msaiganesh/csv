<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1900 1300">
  <defs>
    <style>
      .box { fill: #fff; stroke: #000; stroke-width: 2; }
      .kafka { fill: #231F20; }
      .api { fill: #4CAF50; }
      .elastic { fill: #FEC514; }
      .postgres { fill: #336791; }
      .cassandra { fill: #1287B1; }
      .microservice { fill: #E3F2FD; stroke: #1976D2; stroke-width: 3; }
      .batch { fill: #FFF9C4; stroke: #F57F17; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 13px; fill: #000; text-anchor: middle; }
      .title { font-size: 15px; font-weight: bold; }
      .small { font-size: 11px; }
      .arrow { fill: none; stroke: #333; stroke-width: 2.5; marker-end: url(#arrowhead); }
      .arrow-blue { stroke: #1976D2; stroke-width: 3; marker-end: url(#arrowhead-blue); }
      .arrow-green { stroke: #388E3C; stroke-width: 3; marker-end: url(#arrowhead-green); }
      .arrow-orange { stroke: #F57C00; stroke-width: 3; marker-end: url(#arrowhead-orange); }
      .arrow-purple { stroke: #7B1FA2; stroke-width: 3; marker-end: url(#arrowhead-purple); }
      .dashed { stroke-dasharray: 6,4; }
      .shadow { filter: drop-shadow(3px 3px 4px rgba(0,0,0,0.3)); }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="11" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-blue" markerWidth="12" markerHeight="12" refX="11" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#1976D2" />
    </marker>
    <marker id="arrowhead-green" markerWidth="12" markerHeight="12" refX="11" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#388E3C" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="12" markerHeight="12" refX="11" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#F57C00" />
    </marker>
    <marker id="arrowhead-purple" markerWidth="12" markerHeight="12" refX="11" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#7B1FA2" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="950" y="35" class="text" style="font-size: 24px; font-weight: bold; fill: #1976D2;">Generic Spring Batch Microservice - Scalable Data Pipeline</text>
  
  <!-- ========== DATA SOURCES LAYER ========== -->
  <rect x="30" y="70" width="340" height="680" rx="10" class="box" style="fill: #FAFAFA; stroke: #666; stroke-width: 2;"/>
  <text x="200" y="100" class="text title" style="font-size: 18px;">External Data Sources</text>
  
  <!-- KAFKA SECTION -->
  <rect x="50" y="120" width="300" height="200" rx="8" class="box kafka shadow"/>
  <text x="200" y="150" class="text title" style="fill: white; font-size: 16px;">Apache Kafka (Event Streaming)</text>
  
  <!-- Day Zero Topic -->
  <rect x="70" y="170" width="120" height="65" rx="5" class="box" style="fill: #37474F;"/>
  <text x="130" y="190" class="text" style="fill: white; font-weight: bold;">Day Zero Topic</text>
  <text x="130" y="208" class="text small" style="fill: #B0BEC5;">topic.initial.load</text>
  <text x="130" y="223" class="text small" style="fill: #B0BEC5;">Full snapshot data</text>
  
  <!-- Delta Topic -->
  <rect x="210" y="170" width="120" height="65" rx="5" class="box" style="fill: #37474F;"/>
  <text x="270" y="190" class="text" style="fill: white; font-weight: bold;">Delta CDC Topic</text>
  <text x="270" y="208" class="text small" style="fill: #B0BEC5;">topic.delta.updates</text>
  <text x="270" y="223" class="text small" style="fill: #B0BEC5;">Change streams</text>
  
  <!-- Kafka Details -->
  <rect x="70" y="250" width="260" height="55" rx="5" class="box" style="fill: #455A64;"/>
  <text x="200" y="268" class="text small" style="fill: white;">Consumer Group: batch-consumer-group</text>
  <text x="200" y="283" class="text small" style="fill: #CFD8DC;">Partitions: Configurable (10-50)</text>
  <text x="200" y="298" class="text small" style="fill: #CFD8DC;">Replication Factor: 3 | Offset: Manual</text>
  
  <!-- UPSTREAM SYSTEMS (Delta Sources) -->
  <rect x="50" y="340" width="300" height="120" rx="8" class="box" style="fill: #FFE0B2; stroke: #E65100; stroke-width: 2; shadow"/>
  <text x="200" y="365" class="text title" style="fill: #E65100; font-size: 15px;">Upstream Systems (Delta Providers)</text>
  
  <rect x="70" y="385" width="85" height="60" rx="4" class="box" style="fill: #FF9800;"/>
  <text x="112" y="405" class="text small" style="fill: white; font-weight: bold;">System A</text>
  <text x="112" y="420" class="text small" style="fill: white;">DB Changes</text>
  <text x="112" y="435" class="text small" style="fill: #FFF3E0;">‚Üí Kafka</text>
  
  <rect x="170" y="385" width="85" height="60" rx="4" class="box" style="fill: #FF9800;"/>
  <text x="212" y="405" class="text small" style="fill: white; font-weight: bold;">System B</text>
  <text x="212" y="420" class="text small" style="fill: white;">Events</text>
  <text x="212" y="435" class="text small" style="fill: #FFF3E0;">‚Üí Kafka</text>
  
  <rect x="270" y="385" width="65" height="60" rx="4" class="box" style="fill: #FF9800;"/>
  <text x="302" y="405" class="text small" style="fill: white; font-weight: bold;">System N</text>
  <text x="302" y="420" class="text small" style="fill: white;">CDC</text>
  <text x="302" y="435" class="text small" style="fill: #FFF3E0;">‚Üí Kafka</text>
  
  <!-- EXTERNAL APIs SECTION -->
  <rect x="50" y="480" width="300" height="130" rx="8" class="box api shadow"/>
  <text x="200" y="505" class="text title" style="fill: white; font-size: 15px;">External APIs & Services</text>
  
  <rect x="70" y="525" width="90" height="70" rx="5" class="box" style="fill: #66BB6A;"/>
  <text x="115" y="545" class="text" style="fill: white; font-weight: bold;">REST APIs</text>
  <text x="115" y="563" class="text small" style="fill: white;">HTTP/HTTPS</text>
  <text x="115" y="578" class="text small" style="fill: #E8F5E9;">GET/POST</text>
  <text x="115" y="590" class="text small" style="fill: #E8F5E9;">Pagination</text>
  
  <rect x="175" y="525" width="75" height="70" rx="5" class="box" style="fill: #66BB6A;"/>
  <text x="212" y="545" class="text small" style="fill: white; font-weight: bold;">GraphQL</text>
  <text x="212" y="563" class="text small" style="fill: white;">Queries</text>
  <text x="212" y="578" class="text small" style="fill: #E8F5E9;">Flexible</text>
  <text x="212" y="590" class="text small" style="fill: #E8F5E9;">Schema</text>
  
  <rect x="265" y="525" width="70" height="70" rx="5" class="box" style="fill: #66BB6A;"/>
  <text x="300" y="545" class="text small" style="fill: white; font-weight: bold;">SOAP/</text>
  <text x="300" y="558" class="text small" style="fill: white; font-weight: bold;">Legacy</text>
  <text x="300" y="575" class="text small" style="fill: #E8F5E9;">XML</text>
  <text x="300" y="587" class="text small" style="fill: #E8F5E9;">WSDL</text>
  
  <!-- OTHER DATA SOURCES -->
  <rect x="50" y="630" width="300" height="100" rx="8" class="box" style="fill: #E1F5FE; stroke: #0277BD; stroke-width: 2; shadow"/>
  <text x="200" y="655" class="text title" style="fill: #01579B; font-size: 15px;">Other Data Sources</text>
  
  <rect x="70" y="675" width="70" height="40" rx="4" class="box" style="fill: #FEC514;"/>
  <text x="105" y="688" class="text small" style="font-weight: bold;">Elasticsearch</text>
  <text x="105" y="705" class="text small">Indices</text>
  
  <rect x="155" y="675" width="70" height="40" rx="4" class="box" style="fill: #1287B1;"/>
  <text x="190" y="688" class="text small" style="font-weight: bold; fill: white;">Cassandra</text>
  <text x="190" y="705" class="text small" style="fill: white;">NoSQL</text>
  
  <rect x="240" y="675" width="80" height="40" rx="4" class="box" style="fill: #0288D1;"/>
  <text x="280" y="688" class="text small" style="fill: white; font-weight: bold;">RDBMS</text>
  <text x="280" y="705" class="text small" style="fill: white;">MySQL/Postgres</text>
  
  <!-- ========== SPRING BATCH MICROSERVICE ========== -->
  <rect x="430" y="70" width="720" height="680" rx="12" class="microservice shadow"/>
  <text x="790" y="105" class="text" style="font-size: 20px; font-weight: bold; fill: #1976D2;">Spring Batch Microservice (Scalable)</text>
  <text x="790" y="128" class="text small" style="fill: #666;">Horizontally Scalable | Kubernetes Ready | Cloud Native</text>
  
  <!-- API Layer -->
  <rect x="450" y="150" width="680" height="75" rx="6" class="box" style="fill: #BBDEFB;"/>
  <text x="790" y="175" class="text title" style="fill: #0D47A1;">REST API Layer (Job Management)</text>
  
  <rect x="470" y="190" width="140" height="25" rx="4" class="box" style="fill: #64B5F6;"/>
  <text x="540" y="207" class="text small" style="fill: white;">POST /batch/trigger</text>
  
  <rect x="625" y="190" width="140" height="25" rx="4" class="box" style="fill: #64B5F6;"/>
  <text x="695" y="207" class="text small" style="fill: white;">GET /batch/status/{id}</text>
  
  <rect x="780" y="190" width="140" height="25" rx="4" class="box" style="fill: #64B5F6;"/>
  <text x="850" y="207" class="text small" style="fill: white;">GET /batch/metrics</text>
  
  <rect x="935" y="190" width="140" height="25" rx="4" class="box" style="fill: #64B5F6;"/>
  <text x="1005" y="207" class="text small" style="fill: white;">POST /batch/restart</text>
  
  <!-- Message Consumers -->
  <rect x="450" y="240" width="330" height="90" rx="6" class="box" style="fill: #263238;"/>
  <text x="615" y="265" class="text title" style="fill: white;">Message Consumers</text>
  
  <rect x="470" y="280" width="145" height="40" rx="4" class="box" style="fill: #37474F;"/>
  <text x="542" y="295" class="text" style="fill: white; font-weight: bold;">KafkaListener</text>
  <text x="542" y="312" class="text small" style="fill: #B0BEC5;">@KafkaListener(Day0)</text>
  
  <rect x="625" y="280" width="145" height="40" rx="4" class="box" style="fill: #37474F;"/>
  <text x="697" y="295" class="text" style="fill: white; font-weight: bold;">KafkaListener</text>
  <text x="697" y="312" class="text small" style="fill: #B0BEC5;">@KafkaListener(Delta)</text>
  
  <!-- Data Source Clients -->
  <rect x="800" y="240" width="330" height="90" rx="6" class="box" style="fill: #1B5E20;"/>
  <text x="965" y="265" class="text title" style="fill: white;">Data Source Clients</text>
  
  <rect x="820" y="280" width="95" height="40" rx="4" class="box" style="fill: #2E7D32;"/>
  <text x="867" y="295" class="text small" style="fill: white; font-weight: bold;">HTTP Client</text>
  <text x="867" y="312" class="text small" style="fill: #C8E6C9;">RestTemplate</text>
  
  <rect x="925" y="280" width="95" height="40" rx="4" class="box" style="fill: #2E7D32;"/>
  <text x="972" y="295" class="text small" style="fill: white; font-weight: bold;">ES Client</text>
  <text x="972" y="312" class="text small" style="fill: #C8E6C9;">HighLevelClient</text>
  
  <rect x="1030" y="280" width="90" height="40" rx="4" class="box" style="fill: #2E7D32;"/>
  <text x="1075" y="295" class="text small" style="fill: white; font-weight: bold;">NoSQL</text>
  <text x="1075" y="312" class="text small" style="fill: #C8E6C9;">Cassandra</text>
  
  <!-- Spring Batch Core -->
  <rect x="450" y="350" width="680" height="380" rx="8" class="batch shadow"/>
  <text x="790" y="380" class="text" style="font-size: 18px; font-weight: bold; fill: #F57F17;">Spring Batch Core Framework</text>
  
  <!-- Job Launcher & Scheduler -->
  <rect x="470" y="400" width="310" height="70" rx="6" class="box" style="fill: #FFF8E1;"/>
  <text x="625" y="425" class="text title" style="fill: #E65100;">Job Launcher & Scheduler</text>
  
  <rect x="490" y="445" width="135" height="20" rx="3" class="box" style="fill: #FFE082;"/>
  <text x="557" y="459" class="text small">SimpleJobLauncher</text>
  
  <rect x="635" y="445" width="135" height="20" rx="3" class="box" style="fill: #FFE082;"/>
  <text x="702" y="459" class="text small">QuartzScheduler</text>
  
  <!-- Job Configuration -->
  <rect x="800" y="400" width="330" height="70" rx="6" class="box" style="fill: #FFF8E1;"/>
  <text x="965" y="425" class="text title" style="fill: #E65100;">Job Configurations</text>
  
  <rect x="820" y="445" width="95" height="20" rx="3" class="box" style="fill: #FFE082;"/>
  <text x="867" y="459" class="text small">BatchJob-1</text>
  
  <rect x="925" y="445" width="95" height="20" rx="3" class="box" style="fill: #FFE082;"/>
  <text x="972" y="459" class="text small">BatchJob-2</text>
  
  <rect x="1030" y="445" width="90" height="20" rx="3" class="box" style="fill: #FFE082;"/>
  <text x="1075" y="459" class="text small">BatchJob-N</text>
  
  <!-- Step 1: Read -->
  <rect x="470" y="490" width="640" height="70" rx="6" class="box" style="fill: #E1F5FE;"/>
  <text x="790" y="515" class="text title" style="fill: #01579B;">Step 1: ItemReader (Multi-Source)</text>
  
  <rect x="490" y="533" width="145" height="22" rx="3" class="box" style="fill: #81D4FA;"/>
  <text x="562" y="548" class="text small">KafkaItemReader</text>
  
  <rect x="645" y="533" width="145" height="22" rx="3" class="box" style="fill: #81D4FA;"/>
  <text x="717" y="548" class="text small">RestApiItemReader</text>
  
  <rect x="800" y="533" width="145" height="22" rx="3" class="box" style="fill: #81D4FA;"/>
  <text x="872" y="548" class="text small">ESScrollReader</text>
  
  <rect x="955" y="533" width="145" height="22" rx="3" class="box" style="fill: #81D4FA;"/>
  <text x="1027" y="548" class="text small">GenericItemReader</text>
  
  <!-- Step 2: Process -->
  <rect x="470" y="580" width="640" height="70" rx="6" class="box" style="fill: #F3E5F5;"/>
  <text x="790" y="605" class="text title" style="fill: #4A148C;">Step 2: ItemProcessor (Transform)</text>
  
  <rect x="490" y="623" width="200" height="22" rx="3" class="box" style="fill: #CE93D8;"/>
  <text x="590" y="638" class="text small" style="fill: white;">Validation & Cleansing</text>
  
  <rect x="700" y="623" width="200" height="22" rx="3" class="box" style="fill: #CE93D8;"/>
  <text x="800" y="638" class="text small" style="fill: white;">Business Logic</text>
  
  <rect x="910" y="623" width="190" height="22" rx="3" class="box" style="fill: #CE93D8;"/>
  <text x="1005" y="638" class="text small" style="fill: white;">Data Enrichment</text>
  
  <!-- Step 3: Write -->
  <rect x="470" y="670" width="640" height="50" rx="6" class="box" style="fill: #E8F5E9;"/>
  <text x="790" y="695" class="text title" style="fill: #1B5E20;">Step 3: ItemWriter (Staging)</text>
  
  <rect x="545" y="708" width="215" height="7" rx="1" class="box" style="fill: #81C784;"/>
  <text x="652" y="714" class="text" style="font-size: 10px;">PostgreSQL Batch Writer</text>
  
  <rect x="775" y="708" width="215" height="7" rx="1" class="box" style="fill: #81C784;"/>
  <text x="882" y="714" class="text" style="font-size: 10px;">Cassandra Batch Writer</text>
  
  <!-- Fault Tolerance -->
  <rect x="470" y="735" width="640" height="25" rx="4" class="box" style="fill: #FFCDD2; stroke: #C62828;"/>
  <text x="790" y="752" class="text small" style="fill: #C62828; font-weight: bold;">Fault Tolerance: Skip | Retry | Restart Policies Enabled</text>
  
  <!-- ========== SCALING INDICATORS ========== -->
  <rect x="430" y="765" width="170" height="60" rx="6" class="box" style="fill: #E8F5E9; stroke: #43A047; stroke-width: 2;"/>
  <text x="515" y="785" class="text title" style="fill: #2E7D32; font-size: 13px;">‚ö° Horizontal Scaling</text>
  <text x="515" y="803" class="text small" style="fill: #1B5E20;">Multiple Instances</text>
  <text x="515" y="818" class="text small" style="fill: #1B5E20;">Load Balanced</text>
  
  <rect x="620" y="765" width="170" height="60" rx="6" class="box" style="fill: #FFF3E0; stroke: #F57C00; stroke-width: 2;"/>
  <text x="705" y="785" class="text title" style="fill: #E65100; font-size: 13px;">üîÑ Partitioning</text>
  <text x="705" y="803" class="text small" style="fill: #BF360C;">Step Partitioning</text>
  <text x="705" y="818" class="text small" style="fill: #BF360C;">Parallel Steps</text>
  
  <rect x="810" y="765" width="170" height="60" rx="6" class="box" style="fill: #E1F5FE; stroke: #0288D1; stroke-width: 2;"/>
  <text x="895" y="785" class="text title" style="fill: #01579B; font-size: 13px;">üìä Monitoring</text>
  <text x="895" y="803" class="text small" style="fill: #0277BD;">Metrics Export</text>
  <text x="895" y="818" class="text small" style="fill: #0277BD;">Health Checks</text>
  
  <rect x="1000" y="765" width="150" height="60" rx="6" class="box" style="fill: #F3E5F5; stroke: #8E24AA; stroke-width: 2;"/>
  <text x="1075" y="785" class="text title" style="fill: #6A1B9A; font-size: 13px;">‚òÅÔ∏è Cloud Ready</text>
  <text x="1075" y="803" class="text small" style="fill: #4A148C;">Kubernetes</text>
  <text x="1075" y="818" class="text small" style="fill: #4A148C;">Docker</text>
  
  <!-- ========== STAGING & METADATA LAYER ========== -->
  <rect x="1210" y="70" width="650" height="340" rx="10" class="box" style="fill: #FAFAFA; stroke: #666; stroke-width: 2;"/>
  <text x="1535" y="100" class="text title" style="font-size: 18px;">Staging & Job Metadata</text>
  
  <!-- PostgreSQL Section -->
  <rect x="1230" y="120" width="610" height="160" rx="8" class="box postgres shadow"/>
  <text x="1535" y="150" class="text title" style="fill: white; font-size: 17px;">PostgreSQL (Primary Metadata & Staging)</text>
  
  <!-- Metadata Tables -->
  <rect x="1250" y="170" width="280" height="95" rx="6" class="box" style="fill: #5C6BC0;"/>
  <text x="1390" y="195" class="text title" style="fill: white;">Job Metadata Schema</text>
  
  <rect x="1270" y="210" width="240" height="16" rx="3" class="box" style="fill: #9FA8DA;"/>
  <text x="1390" y="222" class="text small">batch_job_instance</text>
  
  <rect x="1270" y="231" width="240" height="16" rx="3" class="box" style="fill: #9FA8DA;"/>
  <text x="1390" y="243" class="text small">batch_job_execution</text>
  
  <rect x="1270" y="252" width="240" height="16" rx="3" class="box" style="fill: #9FA8DA;"/>
  <text x="1390" y="264" class="text small">batch_step_execution</text>
  
  <!-- Staging Tables -->
  <rect x="1550" y="170" width="280" height="95" rx="6" class="box" style="fill: #5C6BC0;"/>
  <text x="1690" y="195" class="text title" style="fill: white;">Temp Staging Schema</text>
  
  <rect x="1570" y="210" width="240" height="16" rx="3" class="box" style="fill: #9FA8DA;"/>
  <text x="1690" y="222" class="text small">stg_temp_table_1</text>
  
  <rect x="1570" y="231" width="240" height="16" rx="3" class="box" style="fill: #9FA8DA;"/>
  <text x="1690" y="243" class="text small">stg_temp_table_2</text>
  
  <rect x="1570" y="252" width="240" height="16" rx="3" class="box" style="fill: #9FA8DA;"/>
  <text x="1690" y="264" class="text small">stg_temp_table_n</text>
  
  <!-- Cassandra Staging Section -->
  <rect x="1230" y="300" width="610" height="90" rx="8" class="box cassandra shadow"/>
  <text x="1535" y="330" class="text title" style="fill: white; font-size: 17px;">Cassandra (NoSQL Staging)</text>
  
  <rect x="1250" y="350" width="270" height="30" rx="4" class="box" style="fill: #0D47A1;"/>
  <text x="1385" y="370" class="text small" style="fill: white; font-weight: bold;">Keyspace: staging_keyspace</text>
  
  <rect x="1540" y="350" width="280" height="30" rx="4" class="box" style="fill: #0D47A1;"/>
  <text x="1680" y="365" class="text small" style="fill: white;">Wide-column tables</text>
  <text x="1680" y="378" class="text small" style="fill: #90CAF9;">TTL enabled | Partitioned</text>
  
  <!-- ========== TARGET - ELASTICSEARCH ========== -->
  <rect x="1210" y="430" width="650" height="320" rx="10" class="box" style="fill: #FEC514; stroke: #F57F00; stroke-width: 3; shadow"/>
  <text x="1535" y="465" class="text" style="font-size: 18px; font-weight: bold; fill: #000;">Elasticsearch Target Cluster</text>
  
  <!-- Final Load Step -->
  <rect x="1230" y="485" width="610" height="55" rx="6" class="box" style="fill: #005571;"/>
  <text x="1535" y="508" class="text title" style="fill: white; font-size: 16px;">Step 4: Bulk Index to Elasticsearch</text>
  
  <text x="1535" y="528" class="text small" style="fill: #B2EBF2;">Read from staging ‚Üí Transform ‚Üí Bulk load to ES indices</text>
  
  <!-- ES Indices -->
  <rect x="1230" y="560" width="280" height="170" rx="6" class="box" style="fill: #FFF;"/>
  <text x="1370" y="585" class="text title" style="fill: #000;">Target Indices</text>
  
  <rect x="1250" y="600" width="240" height="28" rx="3" class="box" style="fill: #FFD54F;"/>
  <text x="1370" y="619" class="text small" style="font-weight: bold;">index_pattern_1</text>
  
  <rect x="1250" y="638" width="240" height="28" rx="3" class="box" style="fill: #FFD54F;"/>
  <text x="1370" y="657" class="text small" style="font-weight: bold;">index_pattern_2</text>
  
  <rect x="1250" y="676" width="240" height="28" rx="3" class="box" style="fill: #FFD54F;"/>
  <text x="1370" y="695" class="text small" style="font-weight: bold;">index_pattern_n</text>
  
  <rect x="1250" y="710" width="240" height="15" rx="3" class="box" style="fill: #FFF8E1; stroke: #F57F00;"/>
  <text x="1370" y="721" class="text" style="font-size: 10px;">Bulk: 5000/batch</text>
  
  <!-- ES Features -->
  <rect x="1530" y="560" width="300" height="170" rx="6" class="box" style="fill: #FFF;"/>
  <text x="1680" y="585" class="text title" style="fill: #000;">Cluster Configuration</text>
  
  <text x="1680" y="605" class="text small">‚úì Multi-node cluster (N nodes)</text>
  <text x="1680" y="623" class="text small">‚úì Sharding & Replication</text>
  <text x="1680" y="641" class="text small">‚úì Full-text search</text>
  <text x="1680" y="659" class="text small">‚úì Real-time analytics</text>
  <text x="1680" y="677" class="text small">‚úì Index aliases</text>
  <text x="1680" y="695" class="text small">‚úì Aggregation pipelines</text>
  <text x="1680" y="713" class="text small">‚úì Near real-time (NRT)</text>
  
  <!-- ========== ARROWS - DATA FLOW ========== -->
  
  <!-- Kafka to Microservice -->
  <path d="M 350 220 L 430 265" class="arrow-blue"/>
  <text x="385" y="235" class="text small" style="fill: #1976D2; font-weight: bold;">Stream</text>
  
  <!-- Upstream to Kafka -->
  <path d="M 200 340 L 200 320" class="arrow dashed" style="stroke: #FF9800;"/>
  <text x="220" y="330" class="text small" style="fill: #E65100;">CDC/Events</text>
  
  <!-- APIs to Microservice -->
  <path d="M 350 545 L 430 290" class="arrow-green"/>
  <text x="385" y="410" class="text small" style="fill: #388E3C; font-weight: bold;">Pull/Poll</text>
  
  <!-- Other Sources to Microservice -->
  <path d="M 350 680 L 430 310" class="arrow-orange"/>
  <text x="385" y="495" class="text small" style="fill: #F57C00; font-weight: bold;">Query</text>
  
  <!-- Microservice to PostgreSQL -->
  <path d="M 1150 480 L 1210 200" class="arrow-blue"/>
  <text x="1175" y="330" class="text small" style="fill: #1976D2; font-weight: bold; writing-mode: tb;">Write</text>
  
  <!-- Microservice to Cassandra Staging -->
  <path d="M 1150 500 L 1210 355" class="arrow-purple"/>
  <text x="1175" y="420" class="text small" style="fill: #7B1FA2; font-weight: bold; writing-mode: tb;">Write</text>
  
  <!-- Staging to ES -->
  <path d="M 1535 410 L 1535 430" class="arrow-blue"/>
  <text x="1555" y="420" class="text small" style="fill: #1976D2; font-weight: bold;">Load</text>
  
  <!-- Job Metadata connection -->
  <path d="M 1150 420 L 1210 180" class="arrow dashed"/>
  <text x="1175" y="290" class="text small" style="fill: #666;">Status</text>
  
  <!-- ========== LEGEND SECTION ========== -->
  <rect x="30" y="840" width="1830" height="430" rx="8" class="box" style="fill: #F5F5F5; stroke: #333; stroke-width: 3;"/>
  <text x="950" y="875" class="text" style="font-size: 22px; font-weight: bold; fill: #1976D2;">üìñ Architecture Legend & Data Flow</text>
  
  <!-- Data Flow Types -->
  <rect x="50" y="900" width="880" height="160" rx="6" class="box" style="fill: #FFF; stroke: #666;"/>
  <text x="490" y="925" class="text title" style="font-size: 16px;">Data Flow Patterns</text>
  
  <!-- Row 1 -->
  <rect x="70" y="940" width="200" height="50" rx="4" class="box" style="fill: #E3F2FD;"/>
  <text x="170" y="960" class="text small" style="font-weight: bold;">Day Zero Load</text>
  <text x="170" y="978" class="text small">Initial full snapshot from source systems via Kafka</text>
  
  <rect x="290" y="940" width="200" height="50" rx="4" class="box" style="fill: #FFF3E0;"/>
  <text x="390" y="960" class="text small" style="font-weight: bold;">Delta/CDC Updates</text>
  <text x="390" y="978" class="text small">Real-time incremental changes streamed from upstream</text>
  
  <rect x="510" y="940" width="200" height="50" rx="4" class="box" style="fill: #E8F5E9;"/>
  <text x="610" y="960" class="text small" style="font-weight: bold;">API Polling</text>
  <text x="610" y="978" class="text small">Scheduled batch pulls from external REST/SOAP APIs</text>
  
  <rect x="730" y="940" width="180" height="50" rx="4" class="box" style="fill: #F3E5F5;"/>
  <text x="820" y="960" class="text small" style="font-weight: bold;">Database Query</text>
  <text x="820" y="978" class="text small">Direct reads from ES/Cassandra/RDBMS</text>
  
  <!-- Row 2 -->
  <rect x="70" y="1000" width="200" height="50" rx="4" class="box" style="fill: #FFEBEE;"/>
  <text x="170" y="1020" class="text small" style="font-weight: bold;">Staging Layer</text>
  <text x="170" y="1038" class="text small">Temp tables for validation before final load</text>
  
  <rect x="290" y="1000" width="200" height="50" rx="4" class="box" style="fill: #FFF9C4;"/>
  <text x="390" y="1020" class="text small" style="font-weight: bold;">Bulk Indexing</text>
  <text x="390" y="1038" class="text small">Batch writes to Elasticsearch (5000/batch)</text>
  
  <rect x="510" y="1000" width="200" height="50" rx="4" class="box" style="fill: #E0F2F1;"/>
  <text x="610" y="1020" class="text small" style="font-weight: bold;">Job Metadata</text>
  <text x="610" y="1038" class="text small">PostgreSQL stores execution status/metrics</text>
  
  <rect x="730" y="1000" width="180" height="50" rx="4" class="box" style="fill: #FCE4EC;"/>
  <text x="820" y="1020" class="text small" style="font-weight: bold;">Fault Tolerance</text>
  <text x="820" y="1038" class="text small">Skip/Retry/Restart policies</text>
  
  <!-- Component Details -->
  <rect x="960" y="900" width="870" height="160" rx="6" class="box" style="fill: #FFF; stroke: #666;"/>
  <text x="1395" y="925" class="text title" style="font-size: 16px;">Component Responsibilities</text>
  
  <text x="980" y="950" class="text small" style="text-anchor: start; font-weight: bold;">üîµ Kafka (Event Streaming):</text>
  <text x="1000" y="968" class="text small" style="text-anchor: start;">‚Ä¢ Decouples upstream systems from batch processing</text>
  <text x="1000" y="983" class="text small" style="text-anchor: start;">‚Ä¢ Provides durable message queue with replay capability</text>
  <text x="1000" y="998" class="text small" style="text-anchor: start;">‚Ä¢ Supports both full (day zero) and incremental (delta/CDC) data flows</text>
  
  <text x="980" y="1023" class="text small" style="text-anchor: start; font-weight: bold;">üü¢ Spring Batch Microservice:</text>
  <text x="1000" y="1041" class="text small" style="text-anchor: start;">‚Ä¢ Horizontally scalable job processing engine</text>
  <text x="1000" y="1056" class="text small" style="text-anchor: start;">‚Ä¢ Chunk-based processing with configurable commit intervals</text>
  
  <text x="1480" y="950" class="text small" style="text-anchor: start; font-weight: bold;">üü£ Staging Databases:</text>
  <text x="1500" y="968" class="text small" style="text-anchor: start;">‚Ä¢ PostgreSQL: ACID-compliant temp tables</text>
  <text x="1500" y="983" class="text small" style="text-anchor: start;">‚Ä¢ Cassandra: High-write NoSQL staging</text>
  <text x="1500" y="998" class="text small" style="text-anchor: start;">‚Ä¢ Validation before ES load</text>
  
  <text x="1480" y="1023" class="text small" style="text-anchor: start; font-weight: bold;">üü° Elasticsearch:</text>
  <text x="1500" y="1041" class="text small" style="text-anchor: start;">‚Ä¢ Final indexed data for search/analytics</text>
  <text x="1500" y="1056" class="text small" style="text-anchor: start;">‚Ä¢ NRT search with distributed architecture</text>
  
  <!-- Scaling Strategies -->
  <rect x="50" y="1080" width="1780" height="180" rx="6" class="box" style="fill: #E8F5E9; stroke: #43A047; stroke-width: 2;"/>
  <text x="940" y="1110" class="text" style="font-size: 18px; font-weight: bold; fill: #1B5E20;">‚ö° Scalability & Performance Strategies</text>
  
  <rect x="70" y="1130" width="340" height="115" rx="4" class="box" style="fill: #FFF;"/>
  <text x="240" y="1150" class="text title" style="font-size: 14px; fill: #2E7D32;">Horizontal Scaling</text>
  <text x="90" y="1172" class="text small" style="text-anchor: start;">‚Ä¢ Multiple microservice instances</text>
  <text x="90" y="1188" class="text small" style="text-anchor: start;">‚Ä¢ Load balancing across instances</text>
  <text x="90" y="1204" class="text small" style="text-anchor: start;">‚Ä¢ Kubernetes auto-scaling (HPA)</text>
  <text x="90" y="1220" class="text small" style="text-anchor: start;">‚Ä¢ Stateless design for elasticity</text>
  <text x="90" y="1236" class="text small" style="text-anchor: start;">‚Ä¢ Docker containerized deployment</text>
  
  <rect x="430" y="1130" width="340" height="115" rx="4" class="box" style="fill: #FFF;"/>
  <text x="600" y="1150" class="text title" style="font-size: 14px; fill: #2E7D32;">Parallel Processing</text>
  <text x="450" y="1172" class="text small" style="text-anchor: start;">‚Ä¢ Multi-threaded step execution</text>
  <text x="450" y="1188" class="text small" style="text-anchor: start;">‚Ä¢ Step partitioning (range/hash-based)</text>
  <text x="450" y="1204" class="text small" style="text-anchor: start;">‚Ä¢ Parallel job flows</text>
  <text x="450" y="1220" class="text small" style="text-anchor: start;">‚Ä¢ Task executor pool configuration</text>
  <text x="450" y="1236" class="text small" style="text-anchor: start;">‚Ä¢ Kafka partition-based parallelism</text>
  
  <rect x="790" y="1130" width="340" height="115" rx="4" class="box" style="fill: #FFF;"/>
  <text x="960" y="1150" class="text title" style="font-size: 14px; fill: #2E7D32;">Data Optimization</text>
  <text x="810" y="1172" class="text small" style="text-anchor: start;">‚Ä¢ Chunk size tuning (100-10000)</text>
  <text x="810" y="1188" class="text small" style="text-anchor: start;">‚Ä¢ Bulk writes to staging/ES</text>
  <text x="810" y="1204" class="text small" style="text-anchor: start;">‚Ä¢ Database connection pooling</text>
  <text x="810" y="1220" class="text small" style="text-anchor: start;">‚Ä¢ Async I/O operations</text>
  <text x="810" y="1236" class="text small" style="text-anchor: start;">‚Ä¢ Compression for network transfer</text>
  
  <rect x="1150" y="1130" width="340" height="115" rx="4" class="box" style="fill: #FFF;"/>
  <text x="1320" y="1150" class="text title" style="font-size: 14px; fill: #2E7D32;">Fault Tolerance</text>
  <text x="1170" y="1172" class="text small" style="text-anchor: start;">‚Ä¢ Skip policy for corrupt records</text>
  <text x="1170" y="1188" class="text small" style="text-anchor: start;">‚Ä¢ Retry mechanism with backoff</text>
  <text x="1170" y="1204" class="text small" style="text-anchor: start;">‚Ä¢ Job restart from last checkpoint</text>
  <text x="1170" y="1220" class="text small" style="text-anchor: start;">‚Ä¢ Dead letter queue for failures</text>
  <text x="1170" y="1236" class="text small" style="text-anchor: start;">‚Ä¢ Circuit breaker patterns</text>
  
  <rect x="1510" y="1130" width="300" height="115" rx="4" class="box" style="fill: #FFF;"/>
  <text x="1660" y="1150" class="text title" style="font-size: 14px; fill: #2E7D32;">Monitoring</text>
  <text x="1530" y="1172" class="text small" style="text-anchor: start;">‚Ä¢ Prometheus metrics export</text>
  <text x="1530" y="1188" class="text small" style="text-anchor: start;">‚Ä¢ Grafana dashboards</text>
  <text x="1530" y="1204" class="text small" style="text-anchor: start;">‚Ä¢ Spring Boot Actuator</text>
  <text x="1530" y="1220" class="text small" style="text-anchor: start;">‚Ä¢ Distributed tracing (Zipkin)</text>
  <text x="1530" y="1236" class="text small" style="text-anchor: start;">‚Ä¢ Alert notifications</text>
</svg>
